2020-12-14 21:23:05,964 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-3-thread-1] Routing file updated
2020-12-14 21:23:05,990 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-3-thread-1] New routes created.
2020-12-14 21:23:47,948 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> POST /payment/apigw
2020-12-14 21:23:47,951 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> authorization: PGW eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJwZ3dfZnB0cGxheSIsImV4cCI6MTYwODQzNjQ5NSwiaWF0IjoxNjA3NTcyNDk1fQ.8eJf1Tgr_Saz75Nt-ht6xDHuZNipnLLLIW4Y8PlqwtvlmKtzgP27QUDJDqFlUREWxfEiGKgrnqQvyEzy5zM3SA
2020-12-14 21:23:47,952 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> content-type: application/json
2020-12-14 21:23:47,952 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> user-agent: PostmanRuntime/7.26.1
2020-12-14 21:23:47,952 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> accept: */*
2020-12-14 21:23:47,952 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> cache-control: no-cache
2020-12-14 21:23:47,952 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> postman-token: 2799a7cd-2096-47e4-afca-78fe9c3abbf8
2020-12-14 21:23:47,953 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> host: 127.0.0.1:8881
2020-12-14 21:23:47,953 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> accept-encoding: gzip, deflate, br
2020-12-14 21:23:47,953 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> connection: keep-alive
2020-12-14 21:23:47,953 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> content-length: 292
2020-12-14 21:23:47,953 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|>
2020-12-14 21:23:47,954 TRACE com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] Checking Remote Ip Adress '127.0.0.1' for the request
2020-12-14 21:23:47,954 TRACE com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] Ip Adress '127.0.0.1' is valid
2020-12-14 21:23:47,954 TRACE com.dz.apigw.security.JwtAuthorizationTokenFilter [http-nio-8881-exec-1] Processing authentication for 'http://127.0.0.1:8881/payment/apigw' ...
2020-12-14 21:23:47,954 DEBUG com.dz.apigw.security.JwtAuthorizationTokenFilter [http-nio-8881-exec-1] The request header is 'PGW eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJwZ3dfZnB0cGxheSIsImV4cCI6MTYwODQzNjQ5NSwiaWF0IjoxNjA3NTcyNDk1fQ.8eJf1Tgr_Saz75Nt-ht6xDHuZNipnLLLIW4Y8PlqwtvlmKtzgP27QUDJDqFlUREWxfEiGKgrnqQvyEzy5zM3SA'
2020-12-14 21:23:47,954 DEBUG com.dz.apigw.security.JwtAuthorizationTokenFilter [http-nio-8881-exec-1] Looking for the header start with 'PGW'
2020-12-14 21:23:48,023 DEBUG com.dz.apigw.security.JwtAuthorizationTokenFilter [http-nio-8881-exec-1] checking authentication for user 'pgw_fptplay'
2020-12-14 21:23:48,023 DEBUG com.dz.apigw.security.JwtAuthorizationTokenFilter [http-nio-8881-exec-1] security context was null, so authorizating user
2020-12-14 21:23:48,024 INFO com.dz.apigw.security.JwtUserDetailsService [http-nio-8881-exec-1] [JwtUserDetailsService] load info of user 'pgw_fptplay'
2020-12-14 21:23:48,038 INFO com.dz.apigw.security.JwtUserDetailsService [http-nio-8881-exec-1] [loadUserByUsername] Found user with username 'pgw_fptplay'
2020-12-14 21:23:48,047 INFO com.dz.apigw.security.JwtAuthorizationTokenFilter [http-nio-8881-exec-1] authorizated user 'pgw_fptplay', setting security context
2020-12-14 21:23:48,181 TRACE com.dz.apigw.controllers.APIGWMainController [http-nio-8881-exec-1] Remote request body is '{
	"telco": "viettel",
	"cp_code": "001",
	"service_code": "FPTPLAY",
	"service_id": "FPTPLAYID",
	"package_code": "K",
	"msisdn": "0982051117",
	"account": "0982051117",
	"otp_msg": "385925",
	"trans_id": "1607938091-1172098200",
	"price":1000,
	"cmd":"DOWNLOAD",
	"service": "otp_confirm"
}'
2020-12-14 21:23:48,204 TRACE com.dz.apigw.services.APIGWMainServiceImpl [http-nio-8881-exec-1] Service from the request is 'otp_confirm'
2020-12-14 21:23:48,244 TRACE com.dz.apigw.services.APIGWMainServiceImpl [http-nio-8881-exec-1] [doOTPConfirm] doing otp confirm...
2020-12-14 21:23:48,248 INFO com.dz.apigw.services.OTPConfirmServiceImpl [http-nio-8881-exec-1] [verifyParameter] Starting to check request: 1607938091-1172098200
2020-12-14 21:23:48,249 INFO com.dz.apigw.services.OTPConfirmServiceImpl [http-nio-8881-exec-1] [verifyParameter] Result: true
2020-12-14 21:23:48,252 INFO com.dz.apigw.services.OTPConfirmServiceImpl [http-nio-8881-exec-1] [verifyRequestCredentials] Starting to check request: 1607938091-1172098200
2020-12-14 21:23:48,253 INFO com.dz.apigw.services.OTPConfirmServiceImpl [http-nio-8881-exec-1] [verifyRequestCredentials] Result: true
2020-12-14 21:23:48,571 INFO com.dz.apigw.services.OTPConfirmServiceImpl [http-nio-8881-exec-1] [insertRequest][to DB] Result ID: 5fd7757438b076baeb45708d
2020-12-14 21:23:48,576 INFO com.dz.apigw.msgqueue.AMQPProducer [http-nio-8881-exec-1] Send msg = Notification {notificationType='OTP_CONFIRM_REQUEST', destinationQueueName='null', channel='null', msg='MSG {msgType='OTPCONFIRM_REQUEST', keyword='null', status_process='0', msgRxTime='null', msgRtTime='null', cp_code='001', telco='viettel', service='otp_confirm', service_code='FPTPLAY', service_id='FPTPLAYID', package_code='K', msisdn='0982051117', account='null',cmd='DOWNLOAD',trans_id='1607938091-1172098200',price='1000',evenTime='null',errorCode='0', packageExpiredTime='null', renewCycleDay='0', shortCode='null', content='null', mo_id='null', originalRequestId='null', cmdType='null', dbId='5fd7757438b076baeb45708d'}'}
2020-12-14 21:23:48,577 TRACE com.dz.apigw.msgqueue.AMQPMsgRouter [http-nio-8881-exec-1] msgKeyword = null
2020-12-14 21:23:48,578 TRACE com.dz.apigw.msgqueue.AMQPMsgRouter [http-nio-8881-exec-1] no matching telco found
2020-12-14 21:23:48,578 TRACE com.dz.apigw.msgqueue.AMQPMsgRouter [http-nio-8881-exec-1] msgKeyword = null
2020-12-14 21:23:48,578 TRACE com.dz.apigw.msgqueue.AMQPMsgRouter [http-nio-8881-exec-1] Destination found: name = PAYMENTGW.TELCO.OTPCONFIRM.REQUEST.VIETTEL.MPS, keyword = null
2020-12-14 21:23:48,786 INFO com.dz.apigw.msgqueue.AMQPProducer [http-nio-8881-exec-1] Msg sent to queue[queue:'PAYMENTGW.TELCO.OTPCONFIRM.REQUEST.VIETTEL.MPS']= Notification {notificationType='OTP_CONFIRM_REQUEST', destinationQueueName='PAYMENTGW.APIGW.FPTPLAY', channel='null', msg='MSG {msgType='OTPCONFIRM_REQUEST', keyword='null', status_process='0', msgRxTime='null', msgRtTime='null', cp_code='001', telco='viettel', service='otp_confirm', service_code='FPTPLAY', service_id='FPTPLAYID', package_code='K', msisdn='0982051117', account='null',cmd='DOWNLOAD',trans_id='1607938091-1172098200',price='1000',evenTime='null',errorCode='0', packageExpiredTime='null', renewCycleDay='0', shortCode='null', content='null', mo_id='null', originalRequestId='null', cmdType='null', dbId='5fd7757438b076baeb45708d'}'}
2020-12-14 21:23:48,787 INFO com.dz.apigw.services.OTPConfirmServiceImpl [http-nio-8881-exec-1] [getResultOfProcess] starting to select result of the request [5fd7757438b076baeb45708d] from db
2020-12-14 21:23:49,811 INFO com.dz.apigw.services.OTPConfirmServiceImpl [http-nio-8881-exec-1] [getResultOfProcess] starting to select result of the request [5fd7757438b076baeb45708d] from db
2020-12-14 21:23:50,822 INFO com.dz.apigw.services.OTPConfirmServiceImpl [http-nio-8881-exec-1] [getResultOfProcess] starting to select result of the request [5fd7757438b076baeb45708d] from db
2020-12-14 21:23:51,832 INFO com.dz.apigw.services.OTPConfirmServiceImpl [http-nio-8881-exec-1] [getResultOfProcess] starting to select result of the request [5fd7757438b076baeb45708d] from db
2020-12-14 21:23:51,845 WARN com.dz.apigw.services.OTPConfirmServiceImpl [http-nio-8881-exec-1] [getResultOfProcess] the progress of the request is timeout -> return timeout error code to client
2020-12-14 21:23:51,870 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> {
2020-12-14 21:23:51,870 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> 	"telco": "viettel",
2020-12-14 21:23:51,870 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> 	"cp_code": "001",
2020-12-14 21:23:51,871 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> 	"service_code": "FPTPLAY",
2020-12-14 21:23:51,872 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> 	"service_id": "FPTPLAYID",
2020-12-14 21:23:51,872 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> 	"package_code": "K",
2020-12-14 21:23:51,873 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> 	"msisdn": "0982051117",
2020-12-14 21:23:51,873 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> 	"account": "0982051117",
2020-12-14 21:23:51,873 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> 	"otp_msg": "385925",
2020-12-14 21:23:51,874 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> 	"trans_id": "1607938091-1172098200",
2020-12-14 21:23:51,874 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> 	"price":1000,
2020-12-14 21:23:51,874 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> 	"cmd":"DOWNLOAD",
2020-12-14 21:23:51,874 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> 	"service": "otp_confirm"
2020-12-14 21:23:51,874 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> }
2020-12-14 21:23:51,875 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|< 200 OK
2020-12-14 21:23:51,876 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|<
2020-12-14 21:23:51,877 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|< {"error_code":-1,"trans_id":"1607938091-1172098200","message":null}
2020-12-14 21:24:49,142 INFO com.dz.apigw.msgqueue.AMQPConsumer [SimpleAsyncTaskExecutor-1] [listenOnCPQueue] Received a new notification [OTP_CONFIRM_RESPONSE]...
2020-12-14 21:24:49,147 INFO com.dz.apigw.msgqueue.AMQPConsumer [SimpleAsyncTaskExecutor-1] msg: Notification {notificationType='OTP_CONFIRM_RESPONSE', destinationQueueName='null', channel='viettel', msg='MSG {msgType='OTPCONFIRM_RESPONSE', keyword='null', status_process='0', msgRxTime='null', msgRtTime='null', cp_code='null', telco='null', service='null', service_code='null', service_id='null', package_code='null', msisdn='null', account='null',cmd='null',trans_id='null',price='0',evenTime='null',errorCode='-1', packageExpiredTime='null', renewCycleDay='0', shortCode='null', content='null', mo_id='null', originalRequestId='null', cmdType='null', dbId='5fd7757438b076baeb45708d'}'}
2020-12-14 21:24:49,268 INFO com.dz.apigw.services.OTPConfirmServiceImpl [SimpleAsyncTaskExecutor-1] [updateRequest] Found row Id [5fd7757438b076baeb45708d]
2020-12-14 21:24:49,462 INFO com.dz.apigw.services.OTPConfirmServiceImpl [SimpleAsyncTaskExecutor-1] [updateRequest][to DB] [Id: 5fd7757438b076baeb45708d] Result: true
2020-12-14 21:24:58,368 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-6-thread-1] Routing file updated
2020-12-14 21:24:58,438 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-6-thread-1] New routes created.
