2020-06-11 10:21:52,495 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-3-thread-1] Routing file updated
2020-06-11 10:21:52,530 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-3-thread-1] New routes created.
2020-06-11 10:21:57,881 INFO com.dz.apigw.msgqueue.AMQPConsumer [SimpleAsyncTaskExecutor-1] [cpSubscriptionNotification] Received a new notification...
2020-06-11 10:21:57,883 INFO com.dz.apigw.msgqueue.AMQPConsumer [SimpleAsyncTaskExecutor-1] msg: Notification {notificationType='RENEW_REQUEST', destinationQueueName='PAYMENTGW.TELCO.REQUEST.VINAPHONE', channel='vinaphone', msg='MSG {msgType='RENEW_REQUEST', keyword='null', status_process='0', msgRxTime='null', msgRtTime='null', cp_code='null', telco='null', service='null', service_code='TRUYENHINHFPTPLAY', service_id='null', package_code='TQCN', msisdn='84367000711', account='0367000711',cmd='null',trans_id='null',price='0',evenTime='null',errorCode='0', packageExpiredTime='null', renewCycleDay='0', shortCode='null', content='null', mo_id='null', originalRequestId='20200608605', dbId='5ee1a355226bfb7f0c3c263e'}'}
2020-06-11 10:21:57,884 INFO com.dz.apigw.msgqueue.AMQPConsumer [SimpleAsyncTaskExecutor-1] [cpSubscriptionNotification] doing cp subscription notification...
2020-06-11 10:21:57,910 INFO com.dz.apigw.services.PaymentNotificationServiceImpl [SimpleAsyncTaskExecutor-1] [verifyParameter] Starting to check request: 20200608605
2020-06-11 10:21:57,910 INFO com.dz.apigw.services.PaymentNotificationServiceImpl [SimpleAsyncTaskExecutor-1] [verifyParameter] Result: true
2020-06-11 10:21:57,912 INFO com.dz.apigw.services.PaymentNotificationServiceImpl [SimpleAsyncTaskExecutor-1] [processRequest] start to process request: 20200608605 [account=0367000711]
2020-06-11 10:21:57,913 INFO com.dz.apigw.services.PaymentNotificationServiceImpl [SimpleAsyncTaskExecutor-1] [CpId: 20200608605] Sending request [PaymentNotificationRequest {originalRequestId='20200608605', account='0367000711', price='0', serviceCode='FPTPLAY', packageCode='TQCN', evenTime='null', params='1', trans_id='null'}] to http://127.0.0.1/
2020-06-11 10:21:57,997 ERROR com.dz.apigw.services.PaymentNotificationServiceImpl [SimpleAsyncTaskExecutor-1] [processRequest] Exception: I/O error on POST request for "http://127.0.0.1/": Connection refused (Connection refused); nested exception is java.net.ConnectException: Connection refused (Connection refused)
2020-06-11 10:21:57,999 INFO com.dz.apigw.msgqueue.AMQPProducer [SimpleAsyncTaskExecutor-1] Send msg = Notification {notificationType='RENEW_RESPONSE', destinationQueueName='null', channel='null', msg='MSG {msgType='PAYMENT_NOTIFICATION_RESPONSE', keyword='null', status_process='0', msgRxTime='null', msgRtTime='null', cp_code='null', telco='null', service='null', service_code='null', service_id='null', package_code='null', msisdn='null', account='null',cmd='null',trans_id='null',price='0',evenTime='null',errorCode='-1', packageExpiredTime='null', renewCycleDay='0', shortCode='null', content='null', mo_id='null', originalRequestId='null', dbId='5ee1a355226bfb7f0c3c263e'}'}
2020-06-11 10:21:58,012 INFO com.dz.apigw.msgqueue.AMQPProducer [SimpleAsyncTaskExecutor-1] Msg sent to queue[queue:'PAYMENTGW.TELCO.REQUEST.VINAPHONE']= Notification {notificationType='RENEW_RESPONSE', destinationQueueName='null', channel='null', msg='MSG {msgType='PAYMENT_NOTIFICATION_RESPONSE', keyword='null', status_process='0', msgRxTime='null', msgRtTime='null', cp_code='null', telco='null', service='null', service_code='null', service_id='null', package_code='null', msisdn='null', account='null',cmd='null',trans_id='null',price='0',evenTime='null',errorCode='-1', packageExpiredTime='null', renewCycleDay='0', shortCode='null', content='null', mo_id='null', originalRequestId='null', dbId='5ee1a355226bfb7f0c3c263e'}'}
2020-06-11 10:37:00,622 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-3-thread-1] Routing file updated
2020-06-11 10:37:00,707 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-3-thread-1] New routes created.
2020-06-11 10:37:03,329 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> POST /payment/apigw
2020-06-11 10:37:03,330 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> authorization: PGW eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJwZ3dfZnB0cGxheSIsImV4cCI6MTU5MjA5ODM1NSwiaWF0IjoxNTkxMjM0MzU1fQ.9vl56s0ODwGhIUKFtvjPeam6yDeYwN51B9I3HVlZbaUSu62ExsUKkJyTprh5nq5z5mfsS0Ep4f5iH_K7icdoIQ
2020-06-11 10:37:03,331 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> content-type: application/json
2020-06-11 10:37:03,331 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> user-agent: PostmanRuntime/7.24.1
2020-06-11 10:37:03,331 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> accept: */*
2020-06-11 10:37:03,331 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> cache-control: no-cache
2020-06-11 10:37:03,331 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> postman-token: 0a41fde0-15cb-4b9f-b55a-3ee67b818af8
2020-06-11 10:37:03,332 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> host: 127.0.0.1:8881
2020-06-11 10:37:03,332 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> accept-encoding: gzip, deflate, br
2020-06-11 10:37:03,332 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> connection: keep-alive
2020-06-11 10:37:03,332 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|> content-length: 225
2020-06-11 10:37:03,332 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|>
2020-06-11 10:37:03,333 TRACE com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] Checking Remote Ip Adress '127.0.0.1' for the request
2020-06-11 10:37:03,333 TRACE com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] Ip Adress '127.0.0.1' is valid
2020-06-11 10:37:03,333 TRACE com.dz.apigw.security.JwtAuthorizationTokenFilter [http-nio-8881-exec-1] Processing authentication for 'http://127.0.0.1:8881/payment/apigw' ...
2020-06-11 10:37:03,333 DEBUG com.dz.apigw.security.JwtAuthorizationTokenFilter [http-nio-8881-exec-1] The request header is 'PGW eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJwZ3dfZnB0cGxheSIsImV4cCI6MTU5MjA5ODM1NSwiaWF0IjoxNTkxMjM0MzU1fQ.9vl56s0ODwGhIUKFtvjPeam6yDeYwN51B9I3HVlZbaUSu62ExsUKkJyTprh5nq5z5mfsS0Ep4f5iH_K7icdoIQ'
2020-06-11 10:37:03,334 DEBUG com.dz.apigw.security.JwtAuthorizationTokenFilter [http-nio-8881-exec-1] Looking for the header start with 'PGW'
2020-06-11 10:37:03,446 DEBUG com.dz.apigw.security.JwtAuthorizationTokenFilter [http-nio-8881-exec-1] checking authentication for user 'pgw_fptplay'
2020-06-11 10:37:03,446 DEBUG com.dz.apigw.security.JwtAuthorizationTokenFilter [http-nio-8881-exec-1] security context was null, so authorizating user
2020-06-11 10:37:03,446 INFO com.dz.apigw.security.JwtUserDetailsService [http-nio-8881-exec-1] [JwtUserDetailsService] load info of user 'pgw_fptplay'
2020-06-11 10:37:03,447 INFO com.dz.apigw.security.JwtUserDetailsService [http-nio-8881-exec-1] [loadUserByUsername] Found user with username 'pgw_fptplay'
2020-06-11 10:37:03,457 INFO com.dz.apigw.security.JwtAuthorizationTokenFilter [http-nio-8881-exec-1] authorizated user 'pgw_fptplay', setting security context
2020-06-11 10:37:03,534 TRACE com.dz.apigw.controllers.APIGWMainController [http-nio-8881-exec-1] Remote request body is ' {"service":"charge","telco":"vinaphone","cp_code":"001","service_code":"FPTPLAY","service_id":"FPTPLAYID","package_code":"TQCN","msisdn":"0843052080","account":"0843052080","cmd":"RENEW","trans_id":"1590137531-117208501234"}'
2020-06-11 10:37:03,568 TRACE com.dz.apigw.services.APIGWMainServiceImpl [http-nio-8881-exec-1] Service from the request is 'charge'
2020-06-11 10:37:03,617 TRACE com.dz.apigw.services.APIGWMainServiceImpl [http-nio-8881-exec-1] [doTelcoCharge] doing telco charging. Msg = TelcoChargeRequest {cp_code='001', telco='vinaphone', service='charge', service_code='FPTPLAY', service_id='FPTPLAYID', package_code='TQCN', msisdn='0843052080', account='0843052080',cmd='RENEW',trans_id='1590137531-117208501234',datetime='null'}
2020-06-11 10:37:03,620 INFO com.dz.apigw.services.TelcoChargingServiceImpl [http-nio-8881-exec-1] [verifyParameter] Starting to check request: 1590137531-117208501234
2020-06-11 10:37:03,621 INFO com.dz.apigw.services.TelcoChargingServiceImpl [http-nio-8881-exec-1] [verifyParameter] Result: true
2020-06-11 10:37:03,622 INFO com.dz.apigw.services.TelcoChargingServiceImpl [http-nio-8881-exec-1] [verifyRequestCredentials] Starting to check request: 1590137531-117208501234
2020-06-11 10:37:03,622 INFO com.dz.apigw.services.TelcoChargingServiceImpl [http-nio-8881-exec-1] [verifyRequestCredentials] Result: true
2020-06-11 10:37:03,794 INFO com.dz.apigw.services.TelcoChargingServiceImpl [http-nio-8881-exec-1] [insertRequest][to DB] Result ID: 5ee1a6df226bfb086db72964
2020-06-11 10:37:03,795 INFO com.dz.apigw.msgqueue.AMQPProducer [http-nio-8881-exec-1] Send msg = Notification {notificationType='TELCO_CHARGE_REQUEST', destinationQueueName='null', channel='null', msg='MSG {msgType='TELCOCHARGE_REQUEST', keyword='RENEW', status_process='0', msgRxTime='null', msgRtTime='Thu Jun 11 10:37:03 ICT 2020', cp_code='001', telco='vinaphone', service='charge', service_code='FPTPLAY', service_id='FPTPLAYID', package_code='TQCN', msisdn='0843052080', account='0843052080',cmd='RENEW',trans_id='1590137531-117208501234',price='0',evenTime='null',errorCode='0', packageExpiredTime='null', renewCycleDay='0', shortCode='null', content='null', mo_id='null', originalRequestId='null', dbId='5ee1a6df226bfb086db72964'}'}
2020-06-11 10:37:03,796 TRACE com.dz.apigw.msgqueue.AMQPMsgRouter [http-nio-8881-exec-1] msgKeyword = RENEW
2020-06-11 10:37:03,796 TRACE com.dz.apigw.msgqueue.AMQPMsgRouter [http-nio-8881-exec-1] Destination found: name = PAYMENTGW.TELCO.CHARGING.REQUEST.VINAPHONE, keyword = null
2020-06-11 10:37:03,828 INFO com.dz.apigw.msgqueue.AMQPProducer [http-nio-8881-exec-1] Msg sent to queue[queue:'PAYMENTGW.TELCO.CHARGING.REQUEST.VINAPHONE']= Notification {notificationType='TELCO_CHARGE_REQUEST', destinationQueueName='PAYMENTGW.APIGW.FPTPLAY', channel='null', msg='MSG {msgType='TELCOCHARGE_REQUEST', keyword='RENEW', status_process='0', msgRxTime='null', msgRtTime='Thu Jun 11 10:37:03 ICT 2020', cp_code='001', telco='vinaphone', service='charge', service_code='FPTPLAY', service_id='FPTPLAYID', package_code='TQCN', msisdn='0843052080', account='0843052080',cmd='RENEW',trans_id='1590137531-117208501234',price='0',evenTime='null',errorCode='0', packageExpiredTime='null', renewCycleDay='0', shortCode='null', content='null', mo_id='null', originalRequestId='null', dbId='5ee1a6df226bfb086db72964'}'}
2020-06-11 10:37:03,857 INFO com.dz.apigw.services.TelcoChargingServiceImpl [http-nio-8881-exec-1] [getResultOfProcess] starting to select result of the request [5ee1a6df226bfb086db72964] from db
2020-06-11 10:37:05,307 INFO com.dz.apigw.services.TelcoChargingServiceImpl [http-nio-8881-exec-1] [getResultOfProcess] starting to select result of the request [5ee1a6df226bfb086db72964] from db
2020-06-11 10:37:06,312 INFO com.dz.apigw.services.TelcoChargingServiceImpl [http-nio-8881-exec-1] [getResultOfProcess] starting to select result of the request [5ee1a6df226bfb086db72964] from db
2020-06-11 10:37:07,317 INFO com.dz.apigw.services.TelcoChargingServiceImpl [http-nio-8881-exec-1] [getResultOfProcess] starting to select result of the request [5ee1a6df226bfb086db72964] from db
2020-06-11 10:37:07,321 WARN com.dz.apigw.services.TelcoChargingServiceImpl [http-nio-8881-exec-1] [getResultOfProcess] the progress of the request is timeout -> return timeout error code to client
2020-06-11 10:37:07,340 ERROR com.dz.apigw.services.TelcoChargingServiceImpl [http-nio-8881-exec-1] [deleteRecord] The request 5ee1a6df226bfb086db72964 is deleted completely!
2020-06-11 10:37:07,362 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|>  {"service":"charge","telco":"vinaphone","cp_code":"001","service_code":"FPTPLAY","service_id":"FPTPLAYID","package_code":"TQCN","msisdn":"0843052080","account":"0843052080","cmd":"RENEW","trans_id":"1590137531-117208501234"}
2020-06-11 10:37:07,367 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|< 200 OK
2020-06-11 10:37:07,368 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|<
2020-06-11 10:37:07,369 INFO com.dz.apigw.security.AuthorizationIPAddressFilter [http-nio-8881-exec-1] 127.0.0.1|< {"error_code":-1,"trans_id":"1590137531-117208501234"}
2020-06-11 10:39:38,724 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-6-thread-1] Routing file updated
2020-06-11 10:39:38,777 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-6-thread-1] New routes created.
2020-06-11 10:40:06,546 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-9-thread-1] Routing file updated
2020-06-11 10:40:06,560 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-9-thread-1] New routes created.
2020-06-11 10:40:31,681 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-12-thread-1] Routing file updated
2020-06-11 10:40:31,707 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-12-thread-1] New routes created.
2020-06-11 10:41:09,182 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-15-thread-1] Routing file updated
2020-06-11 10:41:09,218 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-15-thread-1] New routes created.
2020-06-11 10:41:26,076 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-18-thread-1] Routing file updated
2020-06-11 10:41:26,122 INFO com.dz.apigw.msgqueue.AMQPMsgRouter [pool-18-thread-1] New routes created.
